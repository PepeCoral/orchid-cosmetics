{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="container mt-5">

  <!-- ⭐ SLIDER DE PRODUCTOS -->
  <h2 class="text-center mb-4" style="color: #a97acf;">Productos Destacados</h2>

  <div class="slider-container">
    <button class="btn text-white mb-3" type="button" data-toggle="collapse" data-target="#searchForm"
      aria-expanded="false" aria-controls="searchForm" style="background-color: #6f42c1;">
      Buscar y Filtrar
    </button>

    <div class="collapse" id="searchForm">
    <div class="card card-body shadow-sm">
      <form method="POST" action="{% url 'search/product' %}" class="row g-3">
        {% csrf_token %}

        <div class="col-md-6">
          <label for="{{ form.name.id_for_label }}" class="form-label">{{ form.name.label }}</label>
          {{ form.name }}
        </div>

        <div class="col-md-6">
          <label for="{{ form.fabricator.id_for_label }}" class="form-label">{{ form.fabricator.label }}</label>
          {{ form.fabricator }}
        </div>

        <div class="col-md-3">
          <label for="{{ form.min_price.id_for_label }}" class="form-label">{{ form.min_price.label }}</label>
          {{ form.min_price }}
        </div>

        <div class="col-md-3">
          <label for="{{ form.max_price.id_for_label }}" class="form-label">{{ form.max_price.label }}</label>
          {{ form.max_price }}
        </div>

        <div class="col-12">
          <label for="{{ form.categories.id_for_label }}" class="form-label">{{ form.categories.label }}</label>
          {{ form.categories }}
        </div>

        <div class="col-12">
          <div class="d-flex">
              <button type="submit" class="btn text-white mr-2" style="background-color: #6f42c1;">
                Aplicar Filtros
              </button>
            <a href="/" class="btn btn-outline-secondary">
              Limpiar Filtros
            </a>
          </div>
        </div>


      </form>
    </div>
  </div>

  <!-- Mostrar filtros activos -->
  {% if form.is_bound %}
  <div class="mb-3">
    <small class="text-muted">
      Filtros activos:
      {% if form.name.value %}
      <span class="badge bg-filter">Nombre: "{{ form.name.value }}"</span>
      {% endif %}
      {% if form.fabricator.value %}
      <span class="badge bg-filter">Fabricante: "{{ form.fabricator.value }}"</span>
      {% endif %}
      {% if form.department.value %}
      <span class="badge bg-filter">Departamento: "{{ form.department.value }}"</span>
      {% endif %}
      {% if form.min_price.value %}
      <span class="badge bg-filter">Precio mínimo: {{ form.min_price.value }}€</span>
      {% endif %}
      {% if form.max_price.value %}
      <span class="badge bg-filter">Precio máximo: {{ form.max_price.value }}€</span>
      {% endif %}
      {% if form.categories.value %}
      <span class="badge bg-filter">{{ form.categories.value|length }} categoría(s)</span>
      {% endif %}
    </small>
  </div>
  {% endif %}

    <div class="slider" id="productSlider">
      {% for p in products %}
      <a href="/products/{{ p.id }}" class="product-card text-decoration-none text-dark">

        {% if p.image_url %}
        <img src="{{ p.image_url.url }}" alt="{{ p.name }}">
        {% else %}
        <div class="no-img">Sin imagen</div>
        {% endif %}

        <div class="card-body">
          <h5 class="card-title">{{ p.name }}</h5>
          <p class="text-muted">Fabricante: {{ p.fabricator }}</p>
          <span class="badge bg-success p-2"><strong>{{ p.price }} €</strong></span>
        </div>

      </a>
      {% endfor %}
    </div>

  </div>

  <hr class="my-5">

  <!-- ⭐ SLIDER DE SERVICIOS -->
  <h2 class="text-center mb-4" style="color: #a97acf;">Servicios Destacados</h2>

  <div class="slider-container">
<button class="btn text-white mb-3" type="button" data-toggle="collapse" data-target="#searchFormServices"
    aria-expanded="false" aria-controls="searchForm" style="background-color: #6f42c1;">
    Buscar y Filtrar
  </button>

  <!-- Collapsible Search Form -->
  <div class="collapse" id="searchFormServices">
    <div class="card card-body shadow-sm">
      <form method="POST" action="{% url 'search/service' %}" class="row g-3">
        {% csrf_token %}

        <div class="col-md-6">
          <label for="{{ formS.name.id_for_label }}" class="form-label">{{ formS.name.label }}</label>
          {{ formS.name }}
        </div>

        <div class="col-md-6">
          <label for="{{ formS.department.id_for_label }}" class="form-label">{{ formS.department.label }}</label>
          {{ formS.department }}
        </div>

        <div class="col-md-3">
          <label for="{{ formS.min_price.id_for_label }}" class="form-label">{{ formS.min_price.label }}</label>
          {{ formS.min_price }}
        </div>

        <div class="col-md-3">
          <label for="{{ formS.max_price.id_for_label }}" class="form-label">{{ formS.max_price.label }}</label>
          {{ formS.max_price }}
        </div>

        <div class="col-12">
          <label for="{{ formS.categories.id_for_label }}" class="form-label">{{ formS.categories.label }}</label>
          {{ formS.categories }}
        </div>

        <div class="col-12">
          <div class="d-flex">
            <button type="submit" class="btn text-white mr-2" style="background-color: #6f42c1;">
              Aplicar Filtros
            </button>
            <a href="/" class="btn btn-outline-secondary">
              Limpiar Filtros
            </a>
          </div>
        </div>


      </form>
    </div>
  </div>

  <!-- Mostrar filtros activos -->
  {% if formS.is_bound %}
  <div class="mb-3">
    <small class="text-muted">
      Filtros activos:
      {% if formS.name.value %}
      <span class="badge bg-filter">Nombre: "{{ formS.name.value }}"</span>
      {% endif %}
      {% if formS.department.value %}
      <span class="badge bg-filter">Departamento: "{{ formS.department.value }}"</span>
      {% endif %}
      {% if formS.min_price.value %}
      <span class="badge bg-filter">Precio mínimo: {{ formS.min_price.value }}€</span>
      {% endif %}
      {% if formS.max_price.value %}
      <span class="badge bg-filter">Precio máximo: {{ formS.max_price.value }}€</span>
      {% endif %}
      {% if formS.categories.value %}
      <span class="badge bg-filter">{{ formS.categories.value|length }} categoría(s)</span>
      {% endif %}
    </small>
  </div>
  {% endif %}

  <hr>
    <div class="slider" id="serviceSlider">

      {% for s in services %}
      <a href="/services/{{ s.id }}" class="product-card text-decoration-none text-dark">

        {% if s.image_url %}
        <img src="{{ s.image_url.url }}" alt="{{ s.name }}">
        {% else %}
        <div class="no-img">Sin imagen</div>
        {% endif %}

        <div class="card-body">
          <h5 class="card-title">{{ s.name }}</h5>
          <p class="text-muted">Departamento: {{ s.department }}</p>
          <span class="badge bg-success p-2"><strong>{{ s.price }} €</strong></span>
        </div>

      </a>
      {% endfor %}

    </div>
    <div class="text-center">
      <h4 style="color: #a97acf;">¿Quieres ver el resto del catalogo?</h4>
    </div>
    <div class="card-body">
      <div class="row justify-content-center text-center">
        <div class="col-md-6">
          <a href="{% url 'product_catalog' %}" class="btn text-white btn-lg"
            style="background-color: #a97acf; border-color: #a97acf;">
            Catalogo de Productos
          </a>
        </div>
        <div class="col-md-6">
          <a href="{% url 'service_catalog' %}" class="btn text-white btn-lg"
            style="background-color: #a97acf; border-color: #a97acf;">
            Catalogo de Servicios
          </a>

        </div>
      </div>
    </div>
  </div>

</div>

<style>
  /* Cards */
  .product-card {
    flex: 0 0 250px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    transition: .2s ease;
    margin-right: 20px;
    cursor: pointer;
    text-decoration: none;
    color: inherit;
  }

  .product-card:hover {
    transform: translateY(-5px);
  }

  .product-card img {
    width: 100%;
    height: 180px;
    object-fit: contain;
    padding: 15px;
  }

  .no-img {
    height: 180px;
    background: #eee;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .card-title {
    font-size: 1.1rem;
    color: #6d4d8f;
  }

  /* Slider containers */
  .slider-container {
    position: relative;
    overflow: hidden;
    padding: 10px;
  }

  .slider {
    display: flex;
    overflow-x: auto;
    scroll-behavior: smooth;
    padding: 10px;
  }

  .slider::-webkit-scrollbar {
    height: 8px;
  }

  .slider::-webkit-scrollbar-thumb {
    background-color: #a97acf;
    border-radius: 10px;
  }

  /* Button controls */
  .slider-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: #a97acf;
    color: white;
    border: none;
    font-size: 22px;
    padding: 8px 12px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 10;
  }

  .slider-btn.left {
    left: 0;
  }

  .slider-btn.right {
    right: 0;
  }
</style>

<script>
  function slideLeft(id) {
    document.getElementById(id)
      .scrollBy({ left: -300, behavior: 'smooth' });
  }

  function slideRight(id) {
    document.getElementById(id)
      .scrollBy({ left: 300, behavior: 'smooth' });
  }
</script>

{% endblock %}
